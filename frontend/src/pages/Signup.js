import React, { useState, useEffect } from "react";
import { useNavigate } from 'react-router-dom';
import LoadingSpinner from "../components/LoadingSpinner";
import "../App.css";
import axios from "axios";
import PhoneInput from 'react-phone-input-2';
import 'react-phone-input-2/lib/style.css';

const Signup = () => {
  const [formData, setFormData] = useState({
    email: "",
    name: "",
    password: "",
    accountType: "",
    phoneNumber: "",
    invitationCode: "",
    repeatPassword: ""
  });

  const [errors, setErrors] = useState({});
  const [validations, setValidations] = useState({
    validPhoneNumber: false,
    validPassword: false
  });

  const [passwordRequirements, setPasswordRequirements] = useState({
    length: false,
    number: false,
    specialChar: false,
    uppercase: false,
    lowercase: false
  });

  const [otp, setOTP] = useState('');
  const [correctOTP, setCorrectOTP] = useState('');
  const [otpSent, setOtpSent] = useState(false);
  const [otpValid, setOtpValid] = useState(false);
  const [isLoading, setIsLoading] = useState(false);
  const [pageLoading, setPageLoading] = useState(true);
  const [currentStep, setCurrentStep] = useState(1);
  const [showPassword, setShowPassword] = useState(false);

  const navigate = useNavigate();

  const steps = [
    { id: 1, title: '‡§ñ‡§æ‡§§‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞', icon: 'üë§' },
    { id: 2, title: '‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä', icon: 'üìù' },
    { id: 3, title: '‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§®', icon: '‚úÖ' }
  ];

  useEffect(() => {
    const timer = setTimeout(() => setPageLoading(false), 800);
    return () => clearTimeout(timer);
  }, []);

  const validateEmail = async (email) => {
    if (!email) {
      return "‡§ï‡•É‡§™‡§Ø‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç";
    }

    const isValid = /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email);
    if (!isValid) {
      return "‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§à‡§Æ‡•á‡§≤ ‡§™‡•ç‡§∞‡§æ‡§∞‡•Ç‡§™";
    }

    try {
      const response = await axios.post("/AuthenticateEmail", { email });
      if (response.data.exists) {
        return response.data.message;
      } else {
        return '';
      }
    } catch (error) {
      return "‡§à‡§Æ‡•á‡§≤ ‡§ú‡§æ‡§Ç‡§ö‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø";
    }
  };

  const validatePassword = (password) => {
    const lengthRegex = /.{8,}/;
    const numberRegex = /\d/;
    const specialCharRegex = /[!@#$%^&*(),.?":{}|<>]/;
    const uppercaseRegex = /[A-Z]/;
    const lowercaseRegex = /[a-z]/;

    const requirements = {
      length: lengthRegex.test(password),
      number: numberRegex.test(password),
      specialChar: specialCharRegex.test(password),
      uppercase: uppercaseRegex.test(password),
      lowercase: lowercaseRegex.test(password)
    };

    setPasswordRequirements(requirements);

    const isPasswordValid = Object.values(requirements).every(req => req);
    setValidations(prev => ({ ...prev, validPassword: isPasswordValid }));
    
    return isPasswordValid ? '' : '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§Ü‡§µ‡§∂‡•ç‡§Ø‡§ï‡§§‡§æ‡§ì‡§Ç ‡§ï‡•ã ‡§™‡•Ç‡§∞‡§æ ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ';
  };

  const validatePhoneNumber = (phoneNumber) => {
    if (!phoneNumber || phoneNumber.length < 10) {
      return "‡§ï‡•É‡§™‡§Ø‡§æ ‡§µ‡•à‡§ß ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç";
    }
    setValidations(prev => ({ ...prev, validPhoneNumber: true }));
    return '';
  };

  const validateInvitationCode = async (code) => {
    if (formData.accountType === "vendor" && !code) {
      return "‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ï‡•ã‡§° ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç";
    }
    
    if (code && formData.accountType === "vendor") {
      try {
        const response = await axios.post("/AuthenticateInvitationCode", { value: code });
        return response.data.exists ? "" : response.data.message;
      } catch (error) {
        return "‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ï‡•ã‡§° ‡§ú‡§æ‡§Ç‡§ö‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø";
      }
    }
    return '';
  };

  const handleInputChange = async (field, value) => {
    setFormData(prev => ({ ...prev, [field]: value }));
    
    // Real-time validation
    let error = '';
    switch (field) {
      case 'email':
        error = await validateEmail(value);
        break;
      case 'password':
        error = validatePassword(value);
        break;
      case 'phoneNumber':
        error = validatePhoneNumber(value);
        break;
      case 'name':
        error = !value ? "‡§ï‡•É‡§™‡§Ø‡§æ ‡§®‡§æ‡§Æ ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç" : '';
        break;
      case 'repeatPassword':
        error = value !== formData.password ? '‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§Æ‡•à‡§ö ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞‡§§‡§æ' : '';
        break;
      case 'invitationCode':
        error = await validateInvitationCode(value);
        break;
    }
    
    setErrors(prev => ({ ...prev, [field]: error }));
  };

  const sendOTP = async () => {
    const phoneError = validatePhoneNumber(formData.phoneNumber);
    if (phoneError) {
      setErrors(prev => ({ ...prev, phoneNumber: phoneError }));
      return;
    }

    setIsLoading(true);
    try {
      const response = await axios.post("/SendOTP", { 
        name: formData.name, 
        phoneNumber: formData.phoneNumber 
      });
      
      if (response.data.success) {
        setOtpSent(true);
        setCorrectOTP(response.data.otp);
        setErrors(prev => ({ ...prev, phoneNumber: '' }));
      } else {
        setErrors(prev => ({ ...prev, phoneNumber: "OTP ‡§≠‡•á‡§ú‡§®‡•á ‡§Æ‡•á‡§Ç ‡§∏‡§Æ‡§∏‡•ç‡§Ø‡§æ" }));
      }
    } catch (error) {
      setErrors(prev => ({ ...prev, phoneNumber: "OTP ‡§≠‡•á‡§ú‡§®‡•á ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø" }));
    }
    setIsLoading(false);
  };

  const verifyOTP = async () => {
    if (otp === correctOTP) {
      setOtpValid(true);
      setCurrentStep(3);
      await signup();
    } else {
      setErrors(prev => ({ ...prev, otp: "‡§ó‡§≤‡§§ OTP" }));
    }
  };

  const signup = async () => {
    setIsLoading(true);
    try {
      const response = await axios.post("/Signup", {
        email: formData.email,
        name: formData.name,
        password: formData.password,
        accountType: formData.accountType,
        phoneNumber: formData.phoneNumber,
        invitationCode: formData.invitationCode
      });
      
      // Success - redirect to success page or login
      navigate('/login?signup=success');
    } catch (error) {
      setErrors(prev => ({ ...prev, general: "‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§Æ‡•á‡§Ç ‡§§‡•ç‡§∞‡•Å‡§ü‡§ø" }));
    }
    setIsLoading(false);
  };

  const nextStep = () => {
    if (currentStep < 3) {
      setCurrentStep(currentStep + 1);
    }
  };

  const prevStep = () => {
    if (currentStep > 1) {
      setCurrentStep(currentStep - 1);
    }
  };

  if (pageLoading) {
    return <LoadingSpinner message="‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§π‡•ã ‡§∞‡§π‡§æ ‡§π‡•à..." />;
  }

  return (
    <React.StrictMode>
      <div className="min-h-screen bg-gradient-to-br from-emerald-50 via-green-50 to-emerald-100 pt-20">
        <div className="max-w-2xl mx-auto px-6 py-8">
          
          {/* Header */}
          <div className="text-center mb-8">
            <div className='inline-flex items-center space-x-3 bg-gradient-to-r from-emerald-100 to-green-100 rounded-full px-6 py-3 mb-6 shadow-lg border border-emerald-200'>
              <span className='text-2xl'>üåü</span>
              <span className='text-emerald-800 font-bold'>‡§®‡§Ø‡§æ ‡§∏‡§¶‡§∏‡•ç‡§Ø</span>
            </div>
            
            <h1 className="text-4xl font-bold bg-gradient-to-r from-emerald-700 to-green-600 bg-clip-text text-transparent mb-4">
              ‡§∏‡§æ‡§á‡§® ‡§Ö‡§™ ‡§ï‡§∞‡•á‡§Ç
            </h1>
            <p className="text-emerald-600 text-lg">
              ‡§∏‡§ö‡•ç‡§ö‡•á ‡§≠‡§æ‡§∞‡§§‡§∂‡§æ‡§≤‡§æ ‡§Ö‡§®‡•Å‡§≠‡§µ ‡§ï‡§æ ‡§Ü‡§®‡§Ç‡§¶ ‡§≤‡•á‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è,<br/>
              ‡§Ö‡§™‡§®‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç
            </p>
          </div>

          {/* Progress Steps */}
          <div className="flex justify-center mb-8">
            <div className="flex items-center space-x-4">
              {steps.map((step, index) => (
                <React.Fragment key={step.id}>
                  <div className={`flex flex-col items-center ${
                    currentStep >= step.id ? 'text-emerald-600' : 'text-gray-400'
                  }`}>
                    <div className={`w-12 h-12 rounded-full flex items-center justify-center text-xl border-2 transition-all duration-300 ${
                      currentStep >= step.id 
                        ? 'bg-emerald-500 text-white border-emerald-500' 
                        : 'bg-white border-gray-300'
                    }`}>
                      {currentStep > step.id ? '‚úì' : step.icon}
                    </div>
                    <span className="text-sm font-medium mt-2">{step.title}</span>
                  </div>
                  {index < steps.length - 1 && (
                    <div className={`w-16 h-1 rounded transition-all duration-300 ${
                      currentStep > step.id ? 'bg-emerald-500' : 'bg-gray-300'
                    }`}></div>
                  )}
                </React.Fragment>
              ))}
            </div>
          </div>

          {/* Form */}
          <div className="bg-white/90 backdrop-blur-sm rounded-3xl p-8 shadow-xl border border-emerald-200">
            
            {/* Step 1: Account Type */}
            {currentStep === 1 && (
              <div className="space-y-6">
                <h3 className="text-2xl font-bold text-emerald-800 text-center mb-6">
                  ‡§ñ‡§æ‡§§‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞ ‡§ö‡•Å‡§®‡•á‡§Ç
                </h3>
                
                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                  <label className={`cursor-pointer border-2 rounded-xl p-6 transition-all duration-300 ${
                    formData.accountType === 'customer' 
                      ? 'border-emerald-500 bg-emerald-50' 
                      : 'border-emerald-200 hover:border-emerald-300'
                  }`}>
                    <input
                      type="radio"
                      name="accountType"
                      value="customer"
                      checked={formData.accountType === 'customer'}
                      onChange={(e) => handleInputChange('accountType', e.target.value)}
                      className="sr-only"
                    />
                    <div className="text-center">
                      <div className="text-4xl mb-3">üõçÔ∏è</div>
                      <h4 className="text-lg font-semibold text-emerald-800 mb-2">‡§ó‡•ç‡§∞‡§æ‡§π‡§ï</h4>
                      <p className="text-emerald-600 text-sm">
                        ‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§ï‡§∞‡•á‡§Ç ‡§î‡§∞ ‡§≠‡§æ‡§∞‡§§ ‡§ï‡•á ‡§¨‡•á‡§π‡§§‡§∞‡•Ä‡§® ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡•ã‡§Ç ‡§ï‡§æ ‡§Ü‡§®‡§Ç‡§¶ ‡§≤‡•á‡§Ç
                      </p>
                    </div>
                  </label>

                  <label className={`cursor-pointer border-2 rounded-xl p-6 transition-all duration-300 ${
                    formData.accountType === 'vendor' 
                      ? 'border-emerald-500 bg-emerald-50' 
                      : 'border-emerald-200 hover:border-emerald-300'
                  }`}>
                    <input
                      type="radio"
                      name="accountType"
                      value="vendor"
                      checked={formData.accountType === 'vendor'}
                      onChange={(e) => handleInputChange('accountType', e.target.value)}
                      className="sr-only"
                    />
                    <div className="text-center">
                      <div className="text-4xl mb-3">üè™</div>
                      <h4 className="text-lg font-semibold text-emerald-800 mb-2">‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ</h4>
                      <p className="text-emerald-600 text-sm">
                        ‡§Ö‡§™‡§®‡•á ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§¨‡•á‡§ö‡•á‡§Ç ‡§î‡§∞ ‡§µ‡•ç‡§Ø‡§æ‡§™‡§æ‡§∞ ‡§¨‡§¢‡§º‡§æ‡§è‡§Ç
                      </p>
                    </div>
                  </label>
                </div>

                {/* Vendor Invitation Code */}
                {formData.accountType === "vendor" && (
                  <div className="mt-6">
                    <label className="block text-emerald-800 font-semibold text-lg mb-2">
                      ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ï‡•ã‡§°
                    </label>
                    <input
                      type="text"
                      value={formData.invitationCode}
                      onChange={(e) => handleInputChange('invitationCode', e.target.value)}
                      className={`w-full px-4 py-4 border-2 rounded-xl transition-all duration-300 ${
                        errors.invitationCode 
                          ? 'border-red-300 focus:border-red-500' 
                          : 'border-emerald-200 focus:border-emerald-500'
                      } focus:outline-none bg-white text-lg`}
                      placeholder="‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ ‡§®‡§ø‡§Æ‡§Ç‡§§‡•ç‡§∞‡§£ ‡§ï‡•ã‡§°"
                    />
                    {errors.invitationCode && (
                      <p className="text-red-500 text-sm mt-2">{errors.invitationCode}</p>
                    )}
                  </div>
                )}

                <button
                  onClick={nextStep}
                  disabled={!formData.accountType || (formData.accountType === 'vendor' && errors.invitationCode)}
                  className="w-full bg-gradient-to-r from-emerald-500 to-green-500 text-white py-4 rounded-xl font-semibold text-lg transition-all duration-300 hover:from-emerald-600 hover:to-green-600 disabled:opacity-50 disabled:cursor-not-allowed"
                >
                  ‡§Ü‡§ó‡•á ‡§¨‡§¢‡§º‡•á‡§Ç
                </button>
              </div>
            )}

            {/* Step 2: Personal Information */}
            {currentStep === 2 && (
              <div className="space-y-6">
                <h3 className="text-2xl font-bold text-emerald-800 text-center mb-6">
                  ‡§µ‡•ç‡§Ø‡§ï‡•ç‡§§‡§ø‡§ó‡§§ ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä
                </h3>

                {/* Name */}
                <div>
                  <label className="block text-emerald-800 font-semibold text-lg mb-2">
                    ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ
                  </label>
                  <input
                    type="text"
                    value={formData.name}
                    onChange={(e) => handleInputChange('name', e.target.value)}
                    className={`w-full px-4 py-4 border-2 rounded-xl transition-all duration-300 ${
                      errors.name 
                        ? 'border-red-300 focus:border-red-500' 
                        : 'border-emerald-200 focus:border-emerald-500'
                    } focus:outline-none bg-white text-lg`}
                    placeholder="‡§Ü‡§™‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§®‡§æ‡§Æ"
                  />
                  {errors.name && (
                    <p className="text-red-500 text-sm mt-2">{errors.name}</p>
                  )}
                </div>

                {/* Email */}
                <div>
                  <label className="block text-emerald-800 font-semibold text-lg mb-2">
                    ‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ
                  </label>
                  <input
                    type="email"
                    value={formData.email}
                    onChange={(e) => handleInputChange('email', e.target.value)}
                    className={`w-full px-4 py-4 border-2 rounded-xl transition-all duration-300 ${
                      errors.email 
                        ? 'border-red-300 focus:border-red-500' 
                        : 'border-emerald-200 focus:border-emerald-500'
                    } focus:outline-none bg-white text-lg`}
                    placeholder="‡§Ü‡§™‡§ï‡§æ ‡§à‡§Æ‡•á‡§≤ ‡§™‡§§‡§æ"
                  />
                  {errors.email && (
                    <p className="text-red-500 text-sm mt-2">{errors.email}</p>
                  )}
                </div>

                {/* Phone Number */}
                <div>
                  <label className="block text-emerald-800 font-semibold text-lg mb-2">
                    ‡§´‡•ã‡§® ‡§®‡§Ç‡§¨‡§∞
                  </label>
                  <PhoneInput
                    country={'in'}
                    value={formData.phoneNumber}
                    onChange={(value) => handleInputChange('phoneNumber', value)}
                    inputStyle={{
                      width: '100%',
                      height: '64px',
                      fontSize: '18px',
                      border: errors.phoneNumber ? '2px solid #fca5a5' : '2px solid #d1fae5',
                      borderRadius: '12px'
                    }}
                    containerStyle={{
                      width: '100%'
                    }}
                  />
                  {errors.phoneNumber && (
                    <p className="text-red-500 text-sm mt-2">{errors.phoneNumber}</p>
                  )}
                  
                  <button
                    onClick={sendOTP}
                    disabled={!validations.validPhoneNumber || otpSent}
                    className="mt-3 bg-emerald-500 text-white px-4 py-2 rounded-lg font-medium hover:bg-emerald-600 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    {otpSent ? 'OTP ‡§≠‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ ‚úì' : 'OTP ‡§≠‡•á‡§ú‡•á‡§Ç'}
                  </button>
                </div>

                {/* OTP Verification */}
                {otpSent && (
                  <div>
                    <label className="block text-emerald-800 font-semibold text-lg mb-2">
                      OTP ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç
                    </label>
                    <input
                      type="text"
                      value={otp}
                      onChange={(e) => setOTP(e.target.value)}
                      className="w-full px-4 py-4 border-2 border-emerald-200 rounded-xl focus:border-emerald-500 focus:outline-none bg-white text-lg text-center tracking-widest"
                      placeholder="6 ‡§Ö‡§Ç‡§ï‡•ã‡§Ç ‡§ï‡§æ OTP"
                      maxLength={6}
                    />
                    {errors.otp && (
                      <p className="text-red-500 text-sm mt-2">{errors.otp}</p>
                    )}
                  </div>
                )}

                {/* Password */}
                <div>
                  <label className="block text-emerald-800 font-semibold text-lg mb-2">
                    ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§°
                  </label>
                  <div className="relative">
                    <input
                      type={showPassword ? "text" : "password"}
                      value={formData.password}
                      onChange={(e) => handleInputChange('password', e.target.value)}
                      className="w-full px-4 py-4 pr-12 border-2 border-emerald-200 rounded-xl focus:border-emerald-500 focus:outline-none bg-white text-lg"
                      placeholder="‡§Æ‡§ú‡§¨‡•Ç‡§§ ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¨‡§®‡§æ‡§è‡§Ç"
                    />
                    <button
                      type="button"
                      onClick={() => setShowPassword(!showPassword)}
                      className="absolute right-4 top-1/2 transform -translate-y-1/2 text-emerald-400 hover:text-emerald-600"
                    >
                      {showPassword ? 'üôà' : 'üëÅÔ∏è'}
                    </button>
                  </div>
                  
                  {/* Password Requirements */}
                  <div className="mt-3 space-y-1">
                    {Object.entries({
                      length: '‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ 8 ‡§Ö‡§ï‡•ç‡§∑‡§∞',
                      number: '‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§∏‡§Ç‡§ñ‡•ç‡§Ø‡§æ',
                      specialChar: '‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§µ‡§ø‡§∂‡•á‡§∑ ‡§ö‡§ø‡§π‡•ç‡§®',
                      uppercase: '‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§¨‡§°‡§º‡§æ ‡§Ö‡§ï‡•ç‡§∑‡§∞',
                      lowercase: '‡§ï‡§Æ ‡§∏‡•á ‡§ï‡§Æ ‡§è‡§ï ‡§õ‡•ã‡§ü‡§æ ‡§Ö‡§ï‡•ç‡§∑‡§∞'
                    }).map(([key, text]) => (
                      <p key={key} className={`text-sm flex items-center ${
                        passwordRequirements[key] ? 'text-green-600' : 'text-gray-500'
                      }`}>
                        <span className="mr-2">{passwordRequirements[key] ? '‚úÖ' : '‚≠ï'}</span>
                        {text}
                      </p>
                    ))}
                  </div>
                </div>

                {/* Repeat Password */}
                <div>
                  <label className="block text-emerald-800 font-semibold text-lg mb-2">
                    ‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡•ã‡§π‡§∞‡§æ‡§è‡§Ç
                  </label>
                  <input
                    type="password"
                    value={formData.repeatPassword}
                    onChange={(e) => handleInputChange('repeatPassword', e.target.value)}
                    className={`w-full px-4 py-4 border-2 rounded-xl transition-all duration-300 ${
                      errors.repeatPassword 
                        ? 'border-red-300 focus:border-red-500' 
                        : 'border-emerald-200 focus:border-emerald-500'
                    } focus:outline-none bg-white text-lg`}
                    placeholder="‡§™‡§æ‡§∏‡§µ‡§∞‡•ç‡§° ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§≤‡§ø‡§ñ‡•á‡§Ç"
                  />
                  {errors.repeatPassword && (
                    <p className="text-red-500 text-sm mt-2">{errors.repeatPassword}</p>
                  )}
                </div>

                <div className="flex space-x-4">
                  <button
                    onClick={prevStep}
                    className="flex-1 border-2 border-emerald-500 text-emerald-600 py-4 rounded-xl font-semibold text-lg hover:bg-emerald-50 transition-all duration-300"
                  >
                    ‡§™‡•Ä‡§õ‡•á
                  </button>
                  <button
                    onClick={otpSent ? verifyOTP : sendOTP}
                    disabled={isLoading || !validations.validPassword || !formData.name || !formData.email || errors.repeatPassword}
                    className="flex-1 bg-gradient-to-r from-emerald-500 to-green-500 text-white py-4 rounded-xl font-semibold text-lg transition-all duration-300 hover:from-emerald-600 hover:to-green-600 disabled:opacity-50 disabled:cursor-not-allowed"
                  >
                    {isLoading ? (
                      <div className="flex items-center justify-center space-x-2">
                        <div className="w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin"></div>
                        <span>‡§™‡•ç‡§∞‡§§‡•Ä‡§ï‡•ç‡§∑‡§æ ‡§ï‡§∞‡•á‡§Ç...</span>
                      </div>
                    ) : otpSent ? 'OTP ‡§∏‡§§‡•ç‡§Ø‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç' : 'OTP ‡§≠‡•á‡§ú‡•á‡§Ç'}
                  </button>
                </div>
              </div>
            )}

            {/* Step 3: Success */}
            {currentStep === 3 && (
              <div className="text-center space-y-6">
                <div className="text-6xl mb-4">üéâ</div>
                <h3 className="text-3xl font-bold text-emerald-800 mb-4">
                  ‡§¨‡§ß‡§æ‡§à ‡§π‡•ã!
                </h3>
                <p className="text-xl text-emerald-600 mb-8">
                  ‡§Ü‡§™‡§ï‡§æ ‡§ñ‡§æ‡§§‡§æ ‡§∏‡§´‡§≤‡§§‡§æ‡§™‡•Ç‡§∞‡•ç‡§µ‡§ï ‡§¨‡§® ‡§ó‡§Ø‡§æ ‡§π‡•à‡•§<br/>
                  ‡§Ö‡§¨ ‡§Ü‡§™ ‡§≠‡§æ‡§∞‡§§‡§∂‡§æ‡§≤‡§æ ‡§ï‡§æ ‡§™‡•Ç‡§∞‡§æ ‡§Ü‡§®‡§Ç‡§¶ ‡§≤‡•á ‡§∏‡§ï‡§§‡•á ‡§π‡•à‡§Ç‡•§
                </p>
                
                <div className="bg-emerald-50 border border-emerald-200 rounded-xl p-6 mb-8">
                  <h4 className="font-semibold text-emerald-800 mb-3">‡§Ü‡§™‡§ï‡•Ä ‡§ú‡§æ‡§®‡§ï‡§æ‡§∞‡•Ä:</h4>
                  <div className="space-y-2 text-emerald-700">
                    <p><strong>‡§®‡§æ‡§Æ:</strong> {formData.name}</p>
                    <p><strong>‡§à‡§Æ‡•á‡§≤:</strong> {formData.email}</p>
                    <p><strong>‡§ñ‡§æ‡§§‡§æ ‡§™‡•ç‡§∞‡§ï‡§æ‡§∞:</strong> {formData.accountType === 'customer' ? '‡§ó‡•ç‡§∞‡§æ‡§π‡§ï' : '‡§µ‡§ø‡§ï‡•ç‡§∞‡•á‡§§‡§æ'}</p>
                  </div>
                </div>

                <button
                  onClick={() => navigate('/login')}
                  className="w-full bg-gradient-to-r from-emerald-500 to-green-500 text-white py-4 rounded-xl font-semibold text-lg transition-all duration-300 hover:from-emerald-600 hover:to-green-600"
                >
                  ‡§≤‡•â‡§ó ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç
                </button>
              </div>
            )}

            {/* General Error */}
            {errors.general && (
              <div className="mt-4 p-4 bg-red-50 border border-red-200 rounded-xl">
                <p className="text-red-600 text-center">{errors.general}</p>
              </div>
            )}
          </div>

          {/* Login Link */}
          <div className="text-center mt-8">
            <p className="text-emerald-600 mb-4">
              ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§ñ‡§æ‡§§‡§æ ‡§π‡•à?
            </p>
            <a
              href="/login"
              className="text-emerald-600 hover:text-emerald-700 font-semibold text-lg border-b-2 border-transparent hover:border-emerald-600 transition-all duration-300"
            >
              ‡§≤‡•â‡§ó ‡§á‡§® ‡§ï‡§∞‡•á‡§Ç!
            </a>
          </div>
        </div>
      </div>
    </React.StrictMode>
  );
};

export default Signup;