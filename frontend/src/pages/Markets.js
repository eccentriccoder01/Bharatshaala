import React, { useState, useEffect } from 'react';
import { useNavigate } from 'react-router-dom';
import LoadingSpinner from '../components/LoadingSpinner';
import MarketCard from '../components/MarketCard';
import SearchBar from '../components/SearchBar';
import FilterPanel from '../components/FilterPanel';
import '../App.css';

// Import actual market images based on your directory structure
import chandniChowkImg from '../images/markets/chandni.png';
import jaipurImg from '../images/markets/jaipur.png';
import laadBazaarImg from '../images/markets/laad.png';
import mysoreImg from '../images/markets/mysore.png';
import colabaImg from '../images/markets/colaba.png';
import commercialStreetImg from '../images/markets/commercial.png';
import dilliHaatImg from '../images/markets/dilli_haat.png';

// Import a fallback placeholder image (create this if it doesn't exist)
import placeholderImg from '../images/placeholder.png';

const Markets = () => {
  const [loading, setLoading] = useState(true);
  const [markets, setMarkets] = useState([]);
  const [filteredMarkets, setFilteredMarkets] = useState([]);
  const [searchTerm, setSearchTerm] = useState('');
  const [selectedState, setSelectedState] = useState('all');
  const [selectedCategory, setSelectedCategory] = useState('all');
  const [sortBy, setSortBy] = useState('popular');
  const [viewMode, setViewMode] = useState('grid');
  const navigate = useNavigate();

  // ... rest of your state and filter arrays remain the same ...

  const states = [
    { id: 'all', name: 'рд╕рднреА рд░рд╛рдЬреНрдп', nameEn: 'All States' },
    { id: 'delhi', name: 'рджрд┐рд▓реНрд▓реА', nameEn: 'Delhi' },
    { id: 'rajasthan', name: 'рд░рд╛рдЬрд╕реНрдерд╛рди', nameEn: 'Rajasthan' },
    { id: 'telangana', name: 'рддреЗрд▓рдВрдЧрд╛рдирд╛', nameEn: 'Telangana' },
    { id: 'karnataka', name: 'рдХрд░реНрдирд╛рдЯрдХ', nameEn: 'Karnataka' },
    { id: 'maharashtra', name: 'рдорд╣рд╛рд░рд╛рд╖реНрдЯреНрд░', nameEn: 'Maharashtra' }
  ];

  const categories = [
    { id: 'all', name: 'рд╕рднреА рд╢реНрд░реЗрдгрд┐рдпрд╛рдВ', icon: 'ЁЯПк' },
    { id: 'traditional', name: 'рдкрд╛рд░рдВрдкрд░рд┐рдХ', icon: 'ЁЯПЫя╕П' },
    { id: 'heritage', name: 'рд╡рд┐рд░рд╛рд╕рдд', icon: 'ЁЯСС' },
    { id: 'modern', name: 'рдЖрдзреБрдирд┐рдХ', icon: 'ЁЯПв' },
    { id: 'handicrafts', name: 'рд╣рд╕реНрддрд╢рд┐рд▓реНрдк', icon: 'ЁЯОи' },
    { id: 'textiles', name: 'рд╡рд╕реНрддреНрд░', icon: 'ЁЯз╡' },
    { id: 'jewelry', name: 'рдЖрднреВрд╖рдг', icon: 'ЁЯТО' }
  ];

  useEffect(() => {
    loadMarketsData();
    const timer = setTimeout(() => setLoading(false), 1200);
    return () => clearTimeout(timer);
  }, []);

  useEffect(() => {
    filterAndSortMarkets();
  }, [markets, searchTerm, selectedState, selectedCategory, sortBy]);

  const loadMarketsData = () => {
    const marketData = [
      {
        id: 'chandni_chowk',
        name: 'Chandni Chowk',
        nameHindi: 'рдЪрд╛рдВрджрдиреА рдЪреМрдХ',
        city: 'Delhi',
        cityHindi: 'рджрд┐рд▓реНрд▓реА',
        state: 'delhi',
        description: 'рднрд╛рд░рдд рдХреЗ рд╕рдмрд╕реЗ рдкреБрд░рд╛рдиреЗ рдФрд░ рд╡реНрдпрд╕реНрдд рдмрд╛рдЬрд╛рд░реЛрдВ рдореЗрдВ рд╕реЗ рдПрдХ, рдЗрд╕рдХреА рд╕рдВрдХрд░реА рдЧрд▓рд┐рдпреЛрдВ рдФрд░ рднреАрдбрд╝рднрд╛рдбрд╝ рдХреЗ рдорд╛рд╣реМрд▓ рдХреА рдЦреЛрдЬ рдХрд░реЗрдВред',
        descriptionEn: 'One of the oldest and busiest markets in India, explore its narrow lanes and bustling atmosphere.',
        image: chandniChowkImg,
        href: '/markets/chandni_chowk',
        rating: 4.8,
        reviews: 2847,
        vendors: 350,
        established: '1650',
        specialties: ['рдорд╕рд╛рд▓реЗ', 'рдЪрд╛рдВрджреА рдХреЗ рдЖрднреВрд╖рдг', 'рдХрдкрдбрд╝реЗ', 'рдорд┐рдард╛рдЗрдпрд╛рдВ'],
        categories: ['traditional', 'heritage', 'handicrafts', 'textiles'],
        openingHours: '10:00 - 21:00',
        popularItems: ['рдЪрд╛рдВрджреА рдХреЗ рдЧрд╣рдиреЗ', 'рдкрд╛рд░рдВрдкрд░рд┐рдХ рдХрдкрдбрд╝реЗ', 'рдорд╕рд╛рд▓реЗ', 'рд╕реНрдЯреНрд░реАрдЯ рдлреВрдб'],
        avgPrice: 'тВ╣500-тВ╣5000',
        bestTime: 'рдирд╡рдВрдмрд░-рдлрд░рд╡рд░реА',
        nearbyAttractions: ['рд▓рд╛рд▓ рдХрд┐рд▓рд╛', 'рдЬрд╛рдорд╛ рдорд╕реНрдЬрд┐рдж', 'рд░рд╛рдЬ рдШрд╛рдЯ'],
        languages: ['рд╣рд┐рдВрджреА', 'рдЕрдВрдЧреНрд░реЗрдЬреА', 'рдЙрд░реНрджреВ', 'рдкрдВрдЬрд╛рдмреА'],
        facilities: ['рдкрд╛рд░реНрдХрд┐рдВрдЧ', 'ATM', 'рдлреВрдб рдХреЛрд░реНрдЯ', 'рдЯреВрд░рд┐рд╕реНрдЯ рдЧрд╛рдЗрдб']
      },
      {
        id: 'pinkcity_bazaar',
        name: 'Pink City Bazaars',
        nameHindi: 'рдЧреБрд▓рд╛рдмреА рд╢рд╣рд░ рдмрд╛рдЬрд╛рд░',
        city: 'Jaipur',
        cityHindi: 'рдЬрдпрдкреБрд░',
        state: 'rajasthan',
        description: 'рдпреЗ рдЬреАрд╡рдВрдд рдмрд╛рдЬрд╛рд░ рдЧрд╣рдиреЗ, рдХрдкрдбрд╝реЗ рдФрд░ рд╣рд╕реНрддрд╢рд┐рд▓реНрдк рдХреА рд╡рд┐рд╡рд┐рдзрддрд╛ рдХрд╛ рдШрд░ рд╣реИрдВред',
        descriptionEn: 'These vibrant bazaars are host to a variety of jewelry, textiles and handicrafts.',
        image: jaipurImg, // тЬЕ Fixed: Using imported image
        href: '/markets/pinkcity_bazaar',
        rating: 4.9,
        reviews: 3245,
        vendors: 220,
        established: '1727',
        specialties: ['рдЬрдпрдкреБрд░реА рдЖрднреВрд╖рдг', 'рдмреНрд▓реЙрдХ рдкреНрд░рд┐рдВрдЯ', 'рдиреАрд▓реА рдорд┐рдЯреНрдЯреА рдХреЗ рдмрд░реНрддрди', 'рд░рд╛рдЬрд╕реНрдерд╛рдиреА рдХрдардкреБрддрд▓реА'],
        categories: ['traditional', 'heritage', 'handicrafts', 'jewelry'],
        openingHours: '10:00 - 20:00',
        popularItems: ['рдХреБрдВрджрди рдЬреНрд╡реЗрд▓рд░реА', 'рдмрдВрдзреЗрдЬ рд╕рд╛рдбрд╝реА', 'рдЬреЛрдзрдкреБрд░реА рдЬреВрддреЗ', 'рдореАрдирд╛рдХрд╛рд░реА'],
        avgPrice: 'тВ╣300-тВ╣25000',
        bestTime: 'рдЕрдХреНрдЯреВрдмрд░-рдорд╛рд░реНрдЪ',
        nearbyAttractions: ['рд╣рд╡рд╛ рдорд╣рд▓', 'рд╕рд┐рдЯреА рдкреИрд▓реЗрд╕', 'рдЕрдВрдмрд░ рдХрд┐рд▓рд╛'],
        languages: ['рд╣рд┐рдВрджреА', 'рдЕрдВрдЧреНрд░реЗрдЬреА', 'рд░рд╛рдЬрд╕реНрдерд╛рдиреА'],
        facilities: ['рдкрд╛рд░реНрдХрд┐рдВрдЧ', 'рдЧрд╛рдЗрдбреЗрдб рдЯреВрд░', 'рдХреИрдлреЗ', 'рд░реЗрд╕реНрдЯ рд░реВрдо']
      },
      {
        id: 'laad_bazaar',
        name: 'Laad Bazaar',
        nameHindi: 'рд▓рд╛рдбрд╝ рдмрд╛рдЬрд╛рд░',
        city: 'Hyderabad',
        cityHindi: 'рд╣реИрджрд░рд╛рдмрд╛рдж',
        state: 'telangana',
        description: 'рдкреНрд░рддрд┐рд╖реНрдард┐рдд рдЪрд╛рд░ рдореАрдирд╛рд░ рдХреЗ рд╕рд╛рдордиреЗ рд╕реНрдерд┐рдд, рдпрд╣ рдмрд╛рдЬрд╛рд░ рдЪреВрдбрд╝рд┐рдпреЛрдВ, рдореЛрддрд┐рдпреЛрдВ рдФрд░ рдкрд╛рд░рдВрдкрд░рд┐рдХ рд╣реИрджрд░рд╛рдмрд╛рджреА рдЖрднреВрд╖рдг рдбрд┐рдЬрд╛рдЗрди рдХрд╛ рд╢рд╛рдирджрд╛рд░ рд╕рдВрдЧреНрд░рд╣ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИред',
        descriptionEn: 'Facing the iconic Char Minar, this market offers a stunning array of bangles, pearls and traditional Hyderabadi jewelry designs.',
        image: laadBazaarImg, // тЬЕ Fixed: Using imported image
        href: '/markets/laad_bazaar',
        rating: 4.7,
        reviews: 1876,
        vendors: 150,
        established: '1591',
        specialties: ['рдореЛрддреА', 'рд▓рд╛рдЦ рдХреА рдЪреВрдбрд╝рд┐рдпрд╛рдВ', 'рдирд┐рдЬрд╝рд╛рдореА рдЖрднреВрд╖рдг', 'рдЕрддреНрддрд░'],
        categories: ['traditional', 'heritage', 'jewelry'],
        openingHours: '11:00 - 21:30',
        popularItems: ['рд╣реИрджрд░рд╛рдмрд╛рджреА рдкрд░реНрд▓реНрд╕', 'рд▓рд╛рдЦ рдмреИрдВрдЧрд▓реНрд╕', 'рджрдХреНрдЦрд┐рдиреА рдХрдкрдбрд╝реЗ'],
        avgPrice: 'тВ╣200-тВ╣50000',
        bestTime: 'рдирд╡рдВрдмрд░-рдлрд░рд╡рд░реА',
        nearbyAttractions: ['рдЪрд╛рд░ рдореАрдирд╛рд░', 'рдордХреНрдХрд╛ рдорд╕реНрдЬрд┐рдж', 'рдЪреМрдорд╣рд▓реНрд▓рд╛ рдкреИрд▓реЗрд╕'],
        languages: ['рд╣рд┐рдВрджреА', 'рдЙрд░реНрджреВ', 'рддреЗрд▓реБрдЧреБ', 'рдЕрдВрдЧреНрд░реЗрдЬреА'],
        facilities: ['рдкрд╛рд░реНрдХрд┐рдВрдЧ', 'рд╕рд┐рдХреНрдпреВрд░рд┐рдЯреА', 'рдлреВрдб рд╕реНрдЯреЙрд▓реНрд╕']
      },
      {
        id: 'devaraja_market',
        name: 'Devaraja Market',
        nameHindi: 'рджреЗрд╡рд░рд╛рдЬ рдорд╛рд░реНрдХреЗрдЯ',
        city: 'Mysore',
        cityHindi: 'рдореИрд╕реВрд░',
        state: 'karnataka',
        description: 'рдпрд╣ рд░рдВрдЧ-рдмрд┐рд░рдВрдЧрд╛ рдмрд╛рдЬрд╛рд░ рдПрдХ рдкрд░реНрдпрдЯрдХ рдЖрдХрд░реНрд╖рдг рднреА рд╣реИ, рдЬрд╣рд╛рдБ рдлреВрд▓реЛрдВ рдХреЗ рдЧреБрдЪреНрдЫреЗ, рдлрд▓ рдФрд░ рд╡рд┐рднрд┐рдиреНрди рд░рдВрдЧреЛрдВ рдХрд╛ рдХреБрдордХреБрдо рдкрд╛рдЙрдбрд░ рдорд┐рд▓рддрд╛ рд╣реИред',
        descriptionEn: 'This colorful market also doubles as a tourist attraction, with bundles of flowers, fruits and various colored Kumkum powder.',
        image: mysoreImg, // тЬЕ Fixed: Using imported image
        href: '/markets/devaraja_market',
        rating: 4.6,
        reviews: 1456,
        vendors: 95,
        established: '1905',
        specialties: ['рдЪрдВрджрди', 'рд░реЗрд╢рдо', 'рдореИрд╕реВрд░ рдкрд╛рдХ', 'рдХреБрдордХреБрдо'],
        categories: ['traditional', 'handicrafts'],
        openingHours: '06:00 - 20:00',
        popularItems: ['рдЪрдВрджрди рдХреА рд▓рдХрдбрд╝реА', 'рдореИрд╕реВрд░ рд╕рд┐рд▓реНрдХ', 'рдлреВрд▓ рдорд╛рд▓рд╛'],
        avgPrice: 'тВ╣100-тВ╣15000',
        bestTime: 'рдЕрдХреНрдЯреВрдмрд░-рдорд╛рд░реНрдЪ',
        nearbyAttractions: ['рдореИрд╕реВрд░ рдкреИрд▓реЗрд╕', 'рдЪрд╛рдореБрдВрдбреА рд╣рд┐рд▓реНрд╕', 'рд╕реЗрдВрдЯ рдлрд┐рд▓реЛрдорд┐рдирд╛ рдЪрд░реНрдЪ'],
        languages: ['рдХрдиреНрдирдбрд╝', 'рд╣рд┐рдВрджреА', 'рдЕрдВрдЧреНрд░реЗрдЬреА'],
        facilities: ['рдкрд╛рд░реНрдХрд┐рдВрдЧ', 'рдЯреВрд░рд┐рд╕реНрдЯ рд╣реЗрд▓реНрдк рдбреЗрд╕реНрдХ', 'рд░реЗрд╕реНрдЯ рд░реВрдо']
      },
      {
        id: 'colaba_causeway',
        name: 'Colaba Causeway',
        nameHindi: 'рдХреЛрд▓рд╛рдмрд╛ рдХреЙрдЬрд╡реЗ',
        city: 'Mumbai',
        cityHindi: 'рдореБрдВрдмрдИ',
        state: 'maharashtra',
        description: 'рдпрд╣ рд▓реЛрдХрдкреНрд░рд┐рдп рд╢реЙрдкрд┐рдВрдЧ рдЧрдВрддрд╡реНрдп рдЕрдкрдиреЗ рдЯреНрд░реЗрдВрдбреА рдлреИрд╢рди рдмреБрдЯреАрдХ рдФрд░ рдкреНрд░рд╛рдЪреАрди рд╡рд╕реНрддреБрдУрдВ рдХреЗ рд▓рд┐рдП рдЬрд╛рдирд╛ рдЬрд╛рддрд╛ рд╣реИред',
        descriptionEn: 'This popular shopping destination is known for its trendy fashion boutiques and antiques.',
        image: colabaImg, // тЬЕ Fixed: Using imported image
        href: '/markets/colaba_causeway',
        rating: 4.5,
        reviews: 2134,
        vendors: 300,
        established: '1838',
        specialties: ['рдПрдВрдЯреАрдХреНрд╕', 'рдлреИрд╢рди', 'рд╣реИрдВрдбреАрдХреНрд░рд╛рдлреНрдЯреНрд╕', 'рдХреИрдлреЗ'],
        categories: ['modern', 'handicrafts'],
        openingHours: '10:00 - 23:00',
        popularItems: ['рд╡рд┐рдВрдЯреЗрдЬ рдХрд▓реЗрдХреНрдЯрд┐рдмрд▓реНрд╕', 'рдбрд┐рдЬрд╝рд╛рдЗрдирд░ рд╡рд┐рдпрд░', 'рд╣реИрдВрдбрдореЗрдб рдЬреНрд╡реЗрд▓рд░реА'],
        avgPrice: 'тВ╣500-тВ╣25000',
        bestTime: 'рдирд╡рдВрдмрд░-рдлрд░рд╡рд░реА',
        nearbyAttractions: ['рдЧреЗрдЯрд╡реЗ рдСрдл рдЗрдВрдбрд┐рдпрд╛', 'рддрд╛рдЬ рд╣реЛрдЯрд▓', 'рдкреНрд░рд┐рдВрд╕ рдСрдл рд╡реЗрд▓реНрд╕ рдореНрдпреВрдЬрд┐рдпрдо'],
        languages: ['рд╣рд┐рдВрджреА', 'рдЕрдВрдЧреНрд░реЗрдЬреА', 'рдорд░рд╛рдареА'],
        facilities: ['рд╡реИрд▓реЗрдЯ рдкрд╛рд░реНрдХрд┐рдВрдЧ', 'рдХреИрдлреЗ', 'рдмреБрдХ рд╕реНрдЯреЛрд░', 'рдЖрд░реНрдЯ рдЧреИрд▓рд░реА']
      },
      {
        id: 'commercial_street',
        name: 'Commercial Street',
        nameHindi: 'рдХреЙрдорд░реНрд╢рд┐рдпрд▓ рд╕реНрдЯреНрд░реАрдЯ',
        city: 'Bengaluru',
        cityHindi: 'рдмреЗрдВрдЧрд▓реБрд░реБ',
        state: 'karnataka',
        description: 'рдмреИрдВрдЧрд▓реЛрд░ рдХреЗ рджрд┐рд▓ рдореЗрдВ рд╕реНрдерд┐рдд рдЗрд╕ рдмрд╛рдЬрд╛рд░ рдореЗрдВ рджреБрдХрд╛рдиреЛрдВ рдХреА рд╡рд┐рд╡рд┐рдз рд╢реНрд░реГрдВрдЦрд▓рд╛ рджреЗрдЦрдиреЗ рд▓рд╛рдпрдХ рд╣реИред',
        descriptionEn: 'The diverse range of shops in this market in the heart of Bangalore is a sight to behold.',
        image: commercialStreetImg, // тЬЕ Fixed: Using imported image
        href: '/markets/commercial_street',
        rating: 4.4,
        reviews: 1987,
        vendors: 250,
        established: '1884',
        specialties: ['рдЗрд▓реЗрдХреНрдЯреНрд░реЙрдирд┐рдХреНрд╕', 'рдмреБрдХреНрд╕', 'рдХрдкрдбрд╝реЗ', 'рдЯреЗрдХ рдЧреИрдЬреЗрдЯреНрд╕'],
        categories: ['modern', 'textiles'],
        openingHours: '10:00 - 21:00',
        popularItems: ['рдЯреЗрдХ рдПрдХреНрд╕реЗрд╕рд░реАрдЬ', 'рдХрд░реНрдирд╛рдЯрдХ рд╣реИрдВрдбрд▓реВрдо', 'рдХреЙрдлреА'],
        avgPrice: 'тВ╣200-тВ╣15000',
        bestTime: 'рдкреВрд░реЗ рд╕рд╛рд▓',
        nearbyAttractions: ['рд╡рд┐рдзрд╛рди рд╕реМрдз', 'рдХрдмреНрдмрди рдкрд╛рд░реНрдХ', 'рдпреВрдмреА рд╕рд┐рдЯреА рдореЙрд▓'],
        languages: ['рдХрдиреНрдирдбрд╝', 'рд╣рд┐рдВрджреА', 'рдЕрдВрдЧреНрд░реЗрдЬреА'],
        facilities: ['рдореЗрдЯреНрд░реЛ рдХрдиреЗрдХреНрдЯрд┐рд╡рд┐рдЯреА', 'рдлреВрдб рдХреЛрд░реНрдЯ', 'ATM', 'рдкрд╛рд░реНрдХрд┐рдВрдЧ']
      },
      {
        id: 'dilli_haat',
        name: 'Dilli Haat',
        nameHindi: 'рджрд┐рд▓реНрд▓реА рд╣рд╛рдЯ',
        city: 'Delhi',
        cityHindi: 'рджрд┐рд▓реНрд▓реА',
        state: 'delhi',
        description: 'рдПрдХ рдЦреБрд▓рд╛ рдмрд╛рдЬрд╛рд░ рдЬреЛ рдкреВрд░реЗ рднрд╛рд░рдд рдХреА рд╣рд╕реНрддрд╢рд┐рд▓реНрдк рдФрд░ рднреЛрдЬрди рдкрд░рдВрдкрд░рд╛рдУрдВ рдХреЛ рдПрдХ рд╕реНрдерд╛рди рдкрд░ рдкреНрд░рд╕реНрддреБрдд рдХрд░рддрд╛ рд╣реИред',
        descriptionEn: 'An open-air market showcasing handicrafts and food traditions from across India in one place.',
        image: dilliHaatImg, // тЬЕ Fixed: Using imported image
        href: '/markets/dilli_haat',
        rating: 4.7,
        reviews: 3421,
        vendors: 200,
        established: '1994',
        specialties: ['рд░рд╛рдЬреНрдпрд╡рд╛рд░ рд╣реИрдВрдбреАрдХреНрд░рд╛рдлреНрдЯреНрд╕', 'рдХреНрд╖реЗрддреНрд░реАрдп рднреЛрдЬрди', 'рд▓рд╛рдЗрд╡ рдкрд░рдлреЙрд░реНрдореЗрдВрд╕', 'рдХрд▓реНрдЪрд░рд▓ рдЗрд╡реЗрдВрдЯреНрд╕'],
        categories: ['traditional', 'handicrafts', 'heritage'],
        openingHours: '10:30 - 22:00',
        popularItems: ['рд╣реИрдВрдбрд▓реВрдо', 'рдкреЙрдЯрд░реА', 'рдСрд░реНрдЧреЗрдирд┐рдХ рдлреВрдб', 'рдЬрдирдЬрд╛рддреАрдп рдЖрд░реНрдЯ'],
        avgPrice: 'тВ╣100-тВ╣5000',
        bestTime: 'рдЕрдХреНрдЯреВрдмрд░-рдорд╛рд░реНрдЪ',
        nearbyAttractions: ['INA рдорд╛рд░реНрдХреЗрдЯ', 'рд▓реЛрдзреА рдЧрд╛рд░реНрдбрди', 'рдЗрдВрдбрд┐рдпрд╛ рдЧреЗрдЯ'],
        languages: ['рд╣рд┐рдВрджреА', 'рдЕрдВрдЧреНрд░реЗрдЬреА', 'рд╕рднреА рднрд╛рд░рддреАрдп рднрд╛рд╖рд╛рдПрдВ'],
        facilities: ['рдПрдВрдЯреНрд░реА рдлреА', 'рдлреВрдб рдХреЛрд░реНрдЯ', 'рдХрд▓реНрдЪрд░рд▓ рд╕реНрдЯреЗрдЬ', 'рдкрд╛рд░реНрдХрд┐рдВрдЧ']
      }
    ];

    setMarkets(marketData);
  };

  // ... rest of your component remains the same ...
  const filterAndSortMarkets = () => {
    let filtered = markets.filter(market => {
      const matchesSearch = market.name.toLowerCase().includes(searchTerm.toLowerCase()) ||
                           market.nameHindi.includes(searchTerm) ||
                           market.city.toLowerCase().includes(searchTerm.toLowerCase()) ||
                           market.specialties.some(specialty => specialty.toLowerCase().includes(searchTerm.toLowerCase()));
      
      const matchesState = selectedState === 'all' || market.state === selectedState;
      const matchesCategory = selectedCategory === 'all' || market.categories.includes(selectedCategory);
      
      return matchesSearch && matchesState && matchesCategory;
    });

    // Sort markets
    filtered.sort((a, b) => {
      switch(sortBy) {
        case 'rating': return b.rating - a.rating;
        case 'reviews': return b.reviews - a.reviews;
        case 'alphabetical': return a.name.localeCompare(b.name);
        case 'established': return parseInt(a.established) - parseInt(b.established);
        case 'popular':
        default: return (b.rating * b.reviews) - (a.rating * a.reviews);
      }
    });

    setFilteredMarkets(filtered);
  };

  if (loading) {
    return <LoadingSpinner message="рднрд╛рд░рдд рдХреЗ рдкреНрд░рд╕рд┐рджреНрдз рдмрд╛рдЬрд╛рд░ рд▓реЛрдб рд╣реЛ рд░рд╣реЗ рд╣реИрдВ..." />;
  }

  return (
    // ... rest of your JSX remains exactly the same ...
    <React.StrictMode>
      <div className='min-h-screen bg-gradient-to-br from-emerald-50 via-green-50 to-emerald-100 pt-20'>

        {/* Hero Section */}
        <div className='relative overflow-hidden'>
          <div className='max-w-7xl mx-auto px-6 py-16 relative z-10'>
            <div className='text-center mb-16'>
              <div className='inline-flex items-center space-x-3 bg-gradient-to-r from-emerald-100 to-green-100 rounded-full px-6 py-3 mb-6 shadow-lg border border-emerald-200'>
                <span className='text-2xl'>ЁЯПк</span>
                <span className='text-emerald-800 font-bold'>рднрд╛рд░рддреАрдп рдмрд╛рдЬрд╛рд░</span>
              </div>
              
              <h1 className='text-5xl md:text-6xl font-bold bg-gradient-to-r from-emerald-700 via-green-600 to-emerald-800 bg-clip-text text-transparent mb-6 leading-tight'>
                рднрд╛рд░рдд рдХреЗ рдкреНрд░рд╕рд┐рджреНрдз рдмрд╛рдЬрд╛рд░
              </h1>
              
              <p className='text-xl md:text-2xl text-emerald-700 max-w-4xl mx-auto leading-relaxed font-medium mb-12'>
                рднрд╛рд░рдд рдХреЗ рд╕рдмрд╕реЗ рдкреНрд░рд╕рд┐рджреНрдз рд╕реНрдерд╛рдиреАрдп рдмрд╛рдЬрд╛рд░реЛрдВ рдореЗрдВ рдШреВрдореЗрдВ,<br/>
                рдкреНрд░рддреНрдпреЗрдХ рдЕрдкрдиреЗ рдЕрдиреВрдареЗ рдЖрдЗрдЯрдо рдФрд░ рдЕрдиреБрднрд╡ рдкреНрд░рджрд╛рди рдХрд░рддрд╛ рд╣реИ
              </p>

              {/* Quick Stats */}
              <div className='grid grid-cols-2 md:grid-cols-4 gap-6 max-w-3xl mx-auto'>
                <div className='text-center bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-emerald-200'>
                  <div className='text-2xl font-bold text-emerald-600'>{markets.length}</div>
                  <div className='text-emerald-600 text-sm font-medium'>рдкреНрд░рд╕рд┐рджреНрдз рдмрд╛рдЬрд╛рд░</div>
                </div>
                <div className='text-center bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-emerald-200'>
                  <div className='text-2xl font-bold text-emerald-600'>{markets.reduce((sum, market) => sum + market.vendors, 0)}</div>
                  <div className='text-emerald-600 text-sm font-medium'>рдХреБрд▓ рд╡рд┐рдХреНрд░реЗрддрд╛</div>
                </div>
                <div className='text-center bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-emerald-200'>
                  <div className='text-2xl font-bold text-emerald-600'>6</div>
                  <div className='text-emerald-600 text-sm font-medium'>рд░рд╛рдЬреНрдп</div>
                </div>
                <div className='text-center bg-white/80 backdrop-blur-sm rounded-xl p-4 border border-emerald-200'>
                  <div className='text-2xl font-bold text-emerald-600'>4.7тнР</div>
                  <div className='text-emerald-600 text-sm font-medium'>рдФрд╕рдд рд░реЗрдЯрд┐рдВрдЧ</div>
                </div>
              </div>
            </div>
          </div>
        </div>

        {/* Search and Filters */}
        <div className='max-w-7xl mx-auto px-6 mb-12'>
          <div className='bg-white/90 backdrop-blur-sm rounded-2xl p-6 shadow-lg'>
            
            {/* Search Bar */}
            <div className='mb-6'>
              <SearchBar 
                value={searchTerm}
                onChange={setSearchTerm}
                placeholder="рдмрд╛рдЬрд╛рд░, рд╢рд╣рд░ рдпрд╛ рдЙрддреНрдкрд╛рдж рдЦреЛрдЬреЗрдВ..."
              />
            </div>

            {/* Filters */}
            <div className='grid grid-cols-1 md:grid-cols-3 gap-6 mb-6'>
              
              {/* State Filter */}
              <div>
                <label className='block text-sm font-semibold text-emerald-800 mb-2'>рд░рд╛рдЬреНрдп рдХреЗ рдЕрдиреБрд╕рд╛рд░</label>
                <select
                  value={selectedState}
                  onChange={(e) => setSelectedState(e.target.value)}
                  className='w-full px-4 py-3 border border-emerald-200 rounded-lg focus:border-emerald-500 focus:outline-none bg-white'
                >
                  {states.map(state => (
                    <option key={state.id} value={state.id}>{state.name}</option>
                  ))}
                </select>
              </div>

              {/* Category Filter */}
              <div>
                <label className='block text-sm font-semibold text-emerald-800 mb-2'>рд╢реНрд░реЗрдгреА рдХреЗ рдЕрдиреБрд╕рд╛рд░</label>
                <select
                  value={selectedCategory}
                  onChange={(e) => setSelectedCategory(e.target.value)}
                  className='w-full px-4 py-3 border border-emerald-200 rounded-lg focus:border-emerald-500 focus:outline-none bg-white'
                >
                  {categories.map(category => (
                    <option key={category.id} value={category.id}>{category.name}</option>
                  ))}
                </select>
              </div>

              {/* Sort Filter */}
              <div>
                <label className='block text-sm font-semibold text-emerald-800 mb-2'>рдХреНрд░рдордмрджреНрдз рдХрд░реЗрдВ</label>
                <select
                  value={sortBy}
                  onChange={(e) => setSortBy(e.target.value)}
                  className='w-full px-4 py-3 border border-emerald-200 rounded-lg focus:border-emerald-500 focus:outline-none bg-white'
                >
                  <option value="popular">рд▓реЛрдХрдкреНрд░рд┐рдпрддрд╛</option>
                  <option value="rating">рд░реЗрдЯрд┐рдВрдЧ</option>
                  <option value="reviews">рд╕рдореАрдХреНрд╖рд╛рдПрдВ</option>
                  <option value="alphabetical">рдирд╛рдо (рдЕ-рдЬреНрдЮ)</option>
                  <option value="established">рд╕реНрдерд╛рдкрдирд╛ рд╡рд░реНрд╖</option>
                </select>
              </div>
            </div>

            {/* View Mode Toggle */}
            <div className='flex justify-between items-center'>
              <div className='text-emerald-600 font-medium'>
                {filteredMarkets.length} рдмрд╛рдЬрд╛рд░ рдорд┐рд▓реЗ
              </div>
              <div className='flex bg-emerald-100 rounded-lg p-1'>
                <button
                  onClick={() => setViewMode('grid')}
                  className={`px-4 py-2 rounded-lg transition-all duration-200 ${
                    viewMode === 'grid' 
                      ? 'bg-emerald-500 text-white' 
                      : 'text-emerald-600 hover:bg-emerald-200'
                  }`}
                >
                  тКЮ рдЧреНрд░рд┐рдб
                </button>
                <button
                  onClick={() => setViewMode('list')}
                  className={`px-4 py-2 rounded-lg transition-all duration-200 ${
                    viewMode === 'list' 
                      ? 'bg-emerald-500 text-white' 
                      : 'text-emerald-600 hover:bg-emerald-200'
                  }`}
                >
                  тШ░ рд▓рд┐рд╕реНрдЯ
                </button>
              </div>
            </div>
          </div>
        </div>

        {/* Markets Grid/List */}
        <div className='max-w-7xl mx-auto px-6 pb-20'>
          {filteredMarkets.length > 0 ? (
            <div className={viewMode === 'grid' 
              ? 'grid grid-cols-1 lg:grid-cols-2 gap-8' 
              : 'space-y-6'
            }>
              {filteredMarkets.map((market) => (
                <MarketCard 
                  key={market.id} 
                  market={market} 
                  viewMode={viewMode}
                  onClick={() => navigate(market.href)}
                />
              ))}
            </div>
          ) : (
            /* No Results */
            <div className='text-center py-20'>
              <div className='text-6xl mb-4'>ЁЯФН</div>
              <h3 className='text-2xl font-bold text-emerald-800 mb-2'>рдХреЛрдИ рдмрд╛рдЬрд╛рд░ рдирд╣реАрдВ рдорд┐рд▓рд╛</h3>
              <p className='text-emerald-600 mb-6'>рдХреГрдкрдпрд╛ рдЕрдкрдирд╛ рдЦреЛрдЬ рд╢рдмреНрдж рдпрд╛ рдлрд╝рд┐рд▓реНрдЯрд░ рдмрджрд▓реЗрдВ</p>
              <button
                onClick={() => {
                  setSearchTerm('');
                  setSelectedState('all');
                  setSelectedCategory('all');
                }}
                className='bg-gradient-to-r from-emerald-500 to-green-500 text-white px-6 py-3 rounded-full font-semibold hover:shadow-lg transition-all duration-300'
              >
                рд╕рднреА рдлрд╝рд┐рд▓реНрдЯрд░ рд╕рд╛рдлрд╝ рдХрд░реЗрдВ
              </button>
            </div>
          )}
        </div>

        {/* Featured Section */}
        <div className='bg-gradient-to-r from-emerald-600 to-green-600 py-16'>
          <div className='max-w-7xl mx-auto px-6 text-center text-white'>
            <h3 className='text-3xl font-bold mb-4'>рдЕрдкрдирд╛ рдкрд╕рдВрджреАрджрд╛ рдмрд╛рдЬрд╛рд░ рдирд╣реАрдВ рдорд┐рд▓рд╛?</h3>
            <p className='text-xl text-emerald-100 mb-8'>
              рд╣рдореЗрдВ рдмрддрд╛рдПрдВ рдФрд░ рд╣рдо рдЗрд╕реЗ рдЬрд▓реНрдж рд╣реА рдЬреЛрдбрд╝ рджреЗрдВрдЧреЗ
            </p>
            <div className='flex flex-col sm:flex-row gap-4 justify-center'>
              <button className='bg-white text-emerald-600 px-8 py-4 rounded-full font-semibold hover:bg-emerald-50 transition-colors duration-300'>
                рдмрд╛рдЬрд╛рд░ рд╕реБрдЭрд╛рдПрдВ
              </button>
              <button className='border-2 border-white text-white px-8 py-4 rounded-full font-semibold hover:bg-white hover:text-emerald-600 transition-all duration-300'>
                рд╕рдВрдкрд░реНрдХ рдХрд░реЗрдВ
              </button>
            </div>
          </div>
        </div>
      </div>
    </React.StrictMode>
  );
};

export default Markets;